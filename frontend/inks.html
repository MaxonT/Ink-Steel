<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ink Collection | Ink & Steel</title>
    <meta name="description" content="Explore our curated collection of fountain pen inks with detailed properties, colors, and purchase links.">
    <meta name="keywords" content="fountain pen ink, ink collection, ink colors, pen ink">
    <meta property="og:title" content="Ink Collection | Ink & Steel">
    <meta property="og:description" content="Explore our curated collection of fountain pen inks with detailed properties, colors, and purchase links.">
    <meta property="og:type" content="website">
    <meta property="og:url" content="">
    <meta property="og:site_name" content="Ink & Steel">
    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="Ink Collection | Ink & Steel">
    <meta name="twitter:description" content="Explore our curated collection of fountain pen inks with detailed properties, colors, and purchase links.">
    <link rel="canonical" href="">
    <link rel="stylesheet" href="assets/styles/tokens.css">
    <link rel="stylesheet" href="assets/styles/states.css">
    <link rel="stylesheet" href="assets/styles/main.css">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="assets/scripts/components/navbar.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="manifest" href="public/manifest.json">
</head>
<body class="min-h-screen">
    <custom-navbar></custom-navbar>

    <main class="page-container">
        <header class="page-header">
            <h1>The Alchemy of Ink</h1>
            <p>Colors that dance between permanence and poetry</p>
        </header>

        <section class="page-content">
            <div id="inksGrid" class="cards-grid">
                <!-- Inks will be loaded here -->
            </div>

            <!-- No Results Message -->
            <div id="noResults" class="hidden state-empty">
                <div class="state-empty-icon">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M9.879 7.519c1.171-1.025 3.071-1.025 4.242 0 1.172 1.025 1.172 2.687 0 3.712-.203.179-.43.326-.67.442-.745.361-1.45.999-1.45 1.827v.75M21 12a9 9 0 11-18 0 9 9 0 0118 0zm-9 5.25h.008v.008H12v-.008z" />
                    </svg>
                </div>
                <h2 class="state-empty-title">No Inks Found</h2>
                <p class="state-empty-description">No inks match your search criteria.</p>
            </div>
        </section>

        <section class="page-section" style="border-top: 1px solid var(--border-color-light); padding-top: var(--spacing-8);">
            <div style="max-width: 900px; margin: 0 auto;">
                <h2 style="font-size: var(--font-size-2xl); font-weight: var(--font-weight-light); margin-bottom: var(--spacing-6); text-align: center;">Ink Properties</h2>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: var(--spacing-5);">
                    <div style="text-align: center; padding: var(--spacing-4); border: 1px solid var(--border-color-light); border-radius: var(--radius-sm);">
                        <h3 style="font-weight: var(--font-weight-medium); margin-bottom: var(--spacing-2);">Shading</h3>
                        <p style="font-size: var(--font-size-sm);">Variation from light to dark within a single stroke</p>
                    </div>
                    <div style="text-align: center; padding: var(--spacing-4); border: 1px solid var(--border-color-light); border-radius: var(--radius-sm);">
                        <h3 style="font-weight: var(--font-weight-medium); margin-bottom: var(--spacing-2);">Sheen</h3>
                        <p style="font-size: var(--font-size-sm);">Metallic reflection when light hits saturated areas</p>
                    </div>
                    <div style="text-align: center; padding: var(--spacing-4); border: 1px solid var(--border-color-light); border-radius: var(--radius-sm);">
                        <h3 style="font-weight: var(--font-weight-medium); margin-bottom: var(--spacing-2);">Flow</h3>
                        <p style="font-size: var(--font-size-sm);">How freely the ink moves from nib to paper</p>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <custom-footer></custom-footer>

    <script src="assets/scripts/components/footer.js"></script>
    <script src="assets/scripts/utils/security.js"></script>
    <script src="assets/scripts/utils/page-utils.js"></script>
    <script src="assets/scripts/utils/loading-states.js"></script>
    <script src="assets/scripts/utils/seo-utils.js"></script>
    <script src="assets/scripts/main.js"></script>
    <script src="assets/scripts/components/ink-swatch.js"></script>
    <script>
        // Update meta URLs
        const siteUrl = getSiteUrl();
        const pageUrl = getPageUrl();
        document.querySelector('meta[property="og:url"]').content = pageUrl;
        document.querySelector('link[rel="canonical"]').href = pageUrl;
    </script>
    <script>
        // Initialize page
        initPageTransition();
        
        // Load inks data with unified loading states
        async function loadInks() {
            const gridElement = document.getElementById('inksGrid');
            
            const result = await loadWithStates(
                () => loadJSONData("data/inks.json"),
                gridElement,
                {
                    skeletonType: 'grid',
                    loadingMessage: 'Loading inks...',
                    errorMessage: 'Failed to load inks. Please try again.',
                    maxRetries: 3,
                    retryDelay: 1000
                }
            );
            
            if (result && result.success) {
                const inks = Array.isArray(result.data?.inks) ? result.data.inks : [];
                renderInks(inks);
            }
        }
        
        // Render inks
        function renderInks(inks) {
            const grid = document.getElementById('inksGrid');
            const noResults = document.getElementById('noResults');
            
            if (!grid || !noResults) {
                if (typeof console !== "undefined" && console.error) console.error('Required DOM elements not found');
                return;
            }
            
            if (!Array.isArray(inks) || inks.length === 0) {
                grid.classList.add('hidden');
                noResults.classList.remove('hidden');
                noResults.innerHTML = `
                    <div class="state-empty">
                        <div class="state-empty-icon">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M9.879 7.519c1.171-1.025 3.071-1.025 4.242 0 1.172 1.025 1.172 2.687 0 3.712-.203.179-.43.326-.67.442-.745.361-1.45.999-1.45 1.827v.75M21 12a9 9 0 11-18 0 9 9 0 0118 0zm-9 5.25h.008v.008H12v-.008z" />
                            </svg>
                        </div>
                        <h2 class="state-empty-title">No Inks Found</h2>
                        <p class="state-empty-description">No inks match your search criteria. Try adjusting your filters.</p>
                    </div>
                `;
                return;
            }
            
            grid.classList.remove('hidden');
            noResults.classList.add('hidden');
            
            const inkCards = inks.map((ink, index) => {
                const inkName = escapeHtml(ink.name || '');
                const inkBrand = ink.brand ? escapeHtml(ink.brand) : '';
                const inkSeries = ink.series ? escapeHtml(ink.series) : '';
                const inkDescription = escapeHtml(ink.description || '');
                const inkDetails = escapeHtml(ink.details || '');
                const inkId = escapeHtml(String(ink.id || ''));
                // inkColor是CSS颜色值，需要验证但不转义HTML（因为它是属性值）
                const inkColor = (ink.color || '#1a365d').replace(/[<>"']/g, '');
                // 墨水瓶图片 URL（可选）
                const bottleImage = ink.image_url || '';
                
                // 构建去歧义的显示名称：Color (Brand) 或 Color (Brand - Series)
                let displayName = inkName;
                if (inkBrand) {
                    if (inkSeries && inkSeries !== inkBrand) {
                        displayName = `${inkName} <span style="color: var(--text-light); font-size: 0.9em; font-weight: 400;">(${inkBrand} - ${inkSeries})</span>`;
                    } else {
                        displayName = `${inkName} <span style="color: var(--text-light); font-size: 0.9em; font-weight: 400;">(${inkBrand})</span>`;
                    }
                }
                
                return `
                    <article class="ink-card" style="animation-delay: ${index * 0.05}s">
                        <div style="padding: var(--spacing-4); background: var(--bg-gray-50); border-radius: var(--radius-sm) var(--radius-sm) 0 0); min-height: 150px; display: flex; align-items: center; justify-content: center;">
                            ${bottleImage ? `
                                <img src="${bottleImage}" alt="${inkName}" style="max-height: 140px; max-width: 100%; object-fit: contain;" loading="lazy" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                                <ink-swatch color="${inkColor}" name="${inkName}" style="display: none;"></ink-swatch>
                            ` : `
                                <ink-swatch color="${inkColor}" name="${inkName}"></ink-swatch>
                            `}
                        </div>
                        <div class="ink-card-content">
                            <h2 class="ink-card-title">${displayName}</h2>
                            <p class="ink-card-description">${inkDescription}</p>
                            ${inkDetails ? `<p style="font-size: var(--font-size-sm); color: var(--text-light); margin-top: var(--spacing-3);">${inkDetails}</p>` : ''}
                            <div class="ink-card-footer" style="margin-top: auto;">
                                <a href="./ink-detail.html?id=${encodeURIComponent(inkId)}" class="ink-card-link">View Details →</a>
                            </div>
                        </div>
                    </article>
                `;
            }).join('');
            
            grid.innerHTML = inkCards;
        }
        
        // Load inks on page load
        loadInks();
    </script>

    <!-- Service Worker Registration -->
    <script>
      if ('serviceWorker' in navigator) {
        window.addEventListener('load', () => {
          navigator.serviceWorker.register('public/service-worker.js')
            .then((registration) => {
              if (typeof console !== 'undefined' && console.log) {
                console.log('Service Worker registered:', registration.scope);
              }
            })
            .catch((error) => {
              if (typeof console !== 'undefined' && console.error) {
                console.error('Service Worker registration failed:', error);
              }
            });
        });
      }
    </script>

</body>
</html>

