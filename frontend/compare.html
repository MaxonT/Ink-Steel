<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Compare Pens | Ink & Steel</title>
    <meta name="description" content="Compare fountain pens side-by-side. View detailed specifications and size comparisons.">
    <meta name="keywords" content="compare pens, pen comparison, fountain pen comparison">
    <meta property="og:title" content="Compare Pens | Ink & Steel">
    <meta property="og:description" content="Compare fountain pens side-by-side. View detailed specifications and size comparisons.">
    <meta property="og:type" content="website">
    <meta property="og:url" content="">
    <meta property="og:site_name" content="Ink & Steel">
    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="Compare Pens | Ink & Steel">
    <meta name="twitter:description" content="Compare fountain pens side-by-side. View detailed specifications and size comparisons.">
    <link rel="canonical" href="">
    <link rel="stylesheet" href="assets/styles/tokens.css">
    <link rel="stylesheet" href="assets/styles/states.css">
    <link rel="stylesheet" href="assets/styles/main.css">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="assets/scripts/components/navbar.js"></script>
    <script src="assets/scripts/components/pen-comparison.js"></script>
    <script src="assets/scripts/components/size-visualization.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="manifest" href="public/manifest.json">
</head>
<body class="min-h-screen">
    <custom-navbar></custom-navbar>

    <main class="page-container">
        <header class="page-header">
            <h1>Compare Pens</h1>
            <p>Side-by-side comparison of fountain pens</p>
        </header>

        <section class="page-content">
            <div id="comparisonContainer" class="page-section">
                <!-- Comparison will be loaded here -->
            </div>

            <div id="sizeVisualization" class="page-section">
                <!-- Size visualization will be loaded here -->
            </div>

            <div class="state-empty" style="display: none;" id="emptyComparison">
                <div class="state-empty-icon">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2" />
                    </svg>
                </div>
                <h2 class="state-empty-title">No Pens Selected</h2>
                <p class="state-empty-description">To compare pens, visit a pen's detail page and click "Add to Comparison"</p>
                <a href="./" class="state-empty-action">Browse Pens â†’</a>
            </div>
        </section>
    </main>

    <custom-footer></custom-footer>

    <script src="assets/scripts/components/footer.js"></script>
    <script src="assets/scripts/utils/security.js"></script>
    <script src="assets/scripts/utils/error-handler.js"></script>
    <script src="assets/scripts/utils/page-utils.js"></script>
    <script src="assets/scripts/utils/seo-utils.js"></script>
    <script src="assets/scripts/main.js"></script>
    <script>
        const siteUrl = getSiteUrl();
        const pageUrl = getPageUrl();
        document.querySelector('meta[property="og:url"]').content = pageUrl;
        document.querySelector('link[rel="canonical"]').href = pageUrl;
    </script>
    <script>
        initPageTransition();

        // Load comparison from localStorage
        function loadComparison() {
            const comparisonIds = safeLocalStorageGet('pen-comparison', []);
            if (!Array.isArray(comparisonIds)) {
                safeLocalStorageSet('pen-comparison', []);
                document.getElementById('comparisonContainer').innerHTML = 
                    '<div class="bg-white p-8 shadow-sm text-center"><p class="text-gray-500 italic">No pens in comparison. Visit pen detail pages to add pens for comparison.</p></div>';
                document.getElementById('sizeVisualization').innerHTML = '';
                return;
            }
            
            if (comparisonIds.length === 0) {
                document.getElementById('comparisonContainer').innerHTML = 
                    '<div class="bg-white p-8 shadow-sm text-center"><p class="text-gray-500 italic">No pens in comparison. Visit pen detail pages to add pens for comparison.</p></div>';
                document.getElementById('sizeVisualization').innerHTML = '';
                return;
            }

            // Load all pens data
            loadJSONData("data/pens.json")
                .then(result => {
                    if (!result.success) {
                        document.getElementById('comparisonContainer').innerHTML = 
                            '<div class="bg-white p-8 shadow-sm text-center"><p class="text-gray-500 italic">Error loading pen data.</p></div>';
                        return;
                    }

                    const pens = result.data.pens.filter(p => comparisonIds.includes(p.id));
                    
                    if (pens.length === 0) {
                        localStorage.removeItem('pen-comparison');
                        loadComparison();
                        return;
                    }

                    // Render comparison
                    const comparisonEl = document.createElement('pen-comparison');
                    comparisonEl.setAttribute('pens', JSON.stringify(pens));
                    document.getElementById('comparisonContainer').innerHTML = '';
                    document.getElementById('comparisonContainer').appendChild(comparisonEl);

                    // Render size visualization
                    const sizeVizEl = document.createElement('size-visualization');
                    sizeVizEl.setAttribute('pens', JSON.stringify(pens));
                    document.getElementById('sizeVisualization').innerHTML = '';
                    document.getElementById('sizeVisualization').appendChild(sizeVizEl);

                    // Event listeners
                    comparisonEl.addEventListener('clear-comparison', () => {
                        try {
                            localStorage.removeItem('pen-comparison');
                        } catch (e) {
                            handleError(e, 'clearComparison', false);
                        }
                        loadComparison();
                    });

                    comparisonEl.addEventListener('remove-from-comparison', (e) => {
                        try {
                            const penId = e.detail?.id;
                            if (!penId) return;
                            
                            const currentIds = safeLocalStorageGet('pen-comparison', []);
                            if (!Array.isArray(currentIds)) {
                                safeLocalStorageSet('pen-comparison', []);
                                loadComparison();
                                return;
                            }
                            
                            const newIds = currentIds.filter(id => id !== penId);
                            safeLocalStorageSet('pen-comparison', newIds);
                            loadComparison();
                        } catch (error) {
                            handleError(error, 'removeFromComparison', true);
                        }
                    });
                });
        }

        loadComparison();
    </script>

    <!-- Service Worker Registration -->
    <script>
      if ('serviceWorker' in navigator) {
        window.addEventListener('load', () => {
          navigator.serviceWorker.register('public/service-worker.js')
            .then((registration) => {
              if (typeof console !== 'undefined' && console.log) {
                console.log('Service Worker registered:', registration.scope);
              }
            })
            .catch((error) => {
              if (typeof console !== 'undefined' && console.error) {
                console.error('Service Worker registration failed:', error);
              }
            });
        });
      }
    </script>

</body>
</html>

